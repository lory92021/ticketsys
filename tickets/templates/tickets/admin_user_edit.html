{% extends "base.html" %}
{% load role_tags %}

{% block title %}Modifica Utente{% endblock %}

{% block content %}

<h2 class="mb-4">Modifica utente: {{ user_obj.username }}</h2>

<div class="card shadow-sm">
    <div class="card-body">

        <form method="POST">
            {% csrf_token %}

            <!-- USERNAME -->
            <label class="form-label"><strong>Username</strong></label>
            <input type="text" name="username" class="form-control"
                   value="{{ user_obj.username }}" required>

            <!-- EMAIL -->
            <label class="form-label mt-3"><strong>Email</strong></label>
            <input type="email" name="email" class="form-control"
                   value="{{ user_obj.email }}" required>


            <!-- GROUPS -->
            <label class="form-label mt-3"><strong>Gruppo</strong></label>
            <select name="group" class="form-select" required>
                {% for g in groups %}
                    <option value="{{ g.id }}"
                        {% if current_group and current_group.id == g.id %}
                            selected
                        {% endif %}
                    >{{ g.name }}</option>
                {% endfor %}
            </select>

            <hr>

            <!-- PASSWORD CHANGE -->
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="change_password"
                       name="change_password" onclick="togglePassword()">
                <label class="form-check-label" for="change_password">
                    Cambia password
                </label>
            </div>

            <div id="password_fields" style="display:none;" class="mt-3">
                <label class="form-label">Nuova password</label>
                <input type="password" name="password1" class="form-control">

                <label class="form-label mt-2">Conferma password</label>
                <input type="password" name="password2" class="form-control">

                <p class="text-muted mt-1">
                    Minimo 8 caratteri, una maiuscola, una minuscola e un numero.
                </p>
            </div>

            <button class="btn btn-primary mt-4">Salva modifiche</button>

        </form>

    </div>
</div>

<script>
function togglePassword() {
    let box = document.getElementById("password_fields");
    box.style.display = document.getElementById("change_password").checked ? "block" : "none";
}
</script>

{% endblock %}
